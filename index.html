<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HotelPro | Obsidian Edition</title>
    
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- Scripts CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/prop-types@15.8.1/prop-types.min.js"></script>
    <script src="https://unpkg.com/recharts@2.12.7/umd/Recharts.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://unpkg.com/jspdf@latest/dist/jspdf.umd.min.js"></script>
    <script src="https://unpkg.com/jspdf-autotable@latest/dist/jspdf.plugin.autotable.min.js"></script>
    <script src="https://unpkg.com/xlsx@latest/dist/xlsx.full.min.js"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Outfit', 'system-ui', 'sans-serif'] },
                    colors: {
                        primary: {"50":"#eff6ff","100":"#dbeafe","200":"#bfdbfe","300":"#93c5fd","400":"#60a5fa","500":"#3b82f6","600":"#2563eb","700":"#1d4ed8","800":"#1e40af","900":"#1e3a8a","950":"#030712"}
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #030712; color: #f3f4f6; -webkit-font-smoothing: antialiased; overflow-x: hidden; }
        .mesh-gradient {
            background-image: radial-gradient(at 0% 0%, rgba(59, 130, 246, 0.1) 0, transparent 50%),
                              radial-gradient(at 100% 100%, rgba(16, 185, 129, 0.08) 0, transparent 50%);
        }
        .glass-card { background: rgba(17, 24, 39, 0.6); backdrop-filter: blur(24px); border: 1px solid rgba(255, 255, 255, 0.05); }
        .glass-nav { background: rgba(3, 7, 18, 0.4); backdrop-filter: blur(32px); border: 1px solid rgba(255, 255, 255, 0.08); }
        
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        .float-anim { animation: float 6s ease-in-out infinite; }
        
        input[type="date"]::-webkit-calendar-picker-indicator { 
            filter: invert(1); 
            cursor: pointer; 
            padding: 4px;
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 10px; }
        
        .date-btn-active { background: rgba(59, 130, 246, 0.2); border-color: rgba(59, 130, 246, 0.3); color: #3b82f6; }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^18.2.0",
    "react-dom": "https://esm.sh/react-dom@^18.2.0",
    "react/": "https://esm.sh/react@^19.2.3/",
    "react-router-dom": "https://esm.sh/react-router-dom@^7.12.0",
    "lucide-react": "https://esm.sh/lucide-react@^0.562.0",
    "recharts": "https://esm.sh/recharts@^3.6.0",
    "jspdf": "https://esm.sh/jspdf@^4.0.0",
    "jspdf-autotable": "https://esm.sh/jspdf-autotable@^5.0.7",
    "xlsx": "https://esm.sh/xlsx@^0.18.5",
    "@supabase/supabase-js": "https://esm.sh/@supabase/supabase-js@^2.90.0"
  }
}
</script>
</head>
<body class="mesh-gradient min-h-screen">
    <div id="root"></div>

    <script>
        const { useState, useEffect, useMemo, useRef } = React;
        const h = React.createElement;

        const Chart = {
            ResponsiveContainer: window.Recharts?.ResponsiveContainer || (() => null),
            AreaChart: window.Recharts?.AreaChart || (() => null),
            XAxis: window.Recharts?.XAxis || (() => null),
            YAxis: window.Recharts?.YAxis || (() => null),
            Tooltip: window.Recharts?.Tooltip || (() => null),
            Area: window.Recharts?.Area || (() => null),
            BarChart: window.Recharts?.BarChart || (() => null),
            Bar: window.Recharts?.Bar || (() => null),
            CartesianGrid: window.Recharts?.CartesianGrid || (() => null),
            Legend: window.Recharts?.Legend || (() => null)
        };

        const formatCurrency = (amt) => new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR', maximumFractionDigits: 0 }).format(amt || 0);
        const getToday = () => new Date().toISOString().split('T')[0];
        const formatDateLong = (ds) => ds ? new Date(ds).toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' }) : 'N/A';
        const getMonthName = (index) => ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"][index];

        const Icon = ({ name, size = 20, className = "" }) => {
            useEffect(() => { if (window.lucide) window.lucide.createIcons(); }, [name]);
            return h('i', { "data-lucide": name, className: `inline-block shrink-0 ${className}`, style: { width: size, height: size } });
        };

        const INITIAL_STAFF = [
            { id: 'st-1', name: 'Vikram Singh', role: 'Manager', salary: 45000 },
            { id: 'st-2', name: 'Anjali Sharma', role: 'Receptionist', salary: 22000 },
            { id: 'st-3', name: 'Rahul Verma', role: 'Head Chef', salary: 35000 }
        ];

        const App = () => {
            const [view, setView] = useState('login');
            const [selectedDate, setSelectedDate] = useState(getToday());
            const [data, setData] = useState(() => {
                const saved = localStorage.getItem('hotelpro_data');
                const parsed = saved ? JSON.parse(saved) : { income: [], expenses: [], staff: INITIAL_STAFF, attendance: [], advances: [] };
                if (!parsed.advances) parsed.advances = [];
                return parsed;
            });
            const [syncing, setSyncing] = useState(false);

            useEffect(() => {
                localStorage.setItem('hotelpro_data', JSON.stringify(data));
            }, [data]);

            const triggerSync = () => {
                setSyncing(true);
                setTimeout(() => setSyncing(false), 800);
            };

            const metrics = useMemo(() => {
                const dayInc = data.income.filter(i => i.date === selectedDate).reduce((s, c) => s + c.amount, 0);
                const dayExp = data.expenses.filter(e => e.date === selectedDate).reduce((s, c) => s + c.amount, 0);
                const present = data.attendance.filter(a => a.date === selectedDate && a.status === 'Present').length;
                return { income: dayInc, expenses: dayExp, profit: dayInc - dayExp, staffPresent: present };
            }, [data, selectedDate]);

            const handleLogin = (key) => {
                if (key === '1234' || key === 'admin') setView('dashboard');
                else alert("ACCESS DENIED");
            };

            return h('div', { className: 'max-w-7xl mx-auto px-4 sm:px-10 pb-32' },
                view === 'login' ? h(LoginView, { onLogin: handleLogin }) : 
                h(React.Fragment, null,
                    h(Header, { selectedDate, setSelectedDate, syncing, setView, onLogout: () => setView('login') }),
                    h('main', { className: 'animate-in fade-in slide-in-from-bottom-4 duration-700' },
                        view === 'dashboard' && h(DashboardView, { metrics, data, selectedDate, setSelectedDate }),
                        view === 'income' && h(LedgerView, { type: 'income', data, setData, selectedDate, triggerSync }),
                        view === 'expenses' && h(LedgerView, { type: 'expenses', data, setData, selectedDate, triggerSync }),
                        view === 'staff' && h(StaffView, { data, setData, selectedDate, triggerSync }),
                        view === 'reports' && h(ReportsView, { data })
                    ),
                    h(QuickNav, { current: view, setView })
                )
            );
        };

        const LoginView = ({ onLogin }) => {
            const [key, setKey] = useState('');
            return h('div', { className: 'h-screen flex items-center justify-center' },
                h('div', { className: 'w-full max-w-md glass-card rounded-[3.5rem] p-12 text-center' },
                    h('div', { className: 'mb-10 inline-block p-6 bg-primary-600 rounded-[2rem] shadow-2xl float-anim' }, h(Icon, { name: 'shield-lock', size: 40, className: 'text-white' })),
                    h('h1', { className: 'text-3xl font-black text-white uppercase tracking-tighter mb-2' }, 'Personnel Login'),
                    h('p', { className: 'text-[9px] font-black text-gray-500 uppercase tracking-[0.4em] mb-12' }, 'Enterprise Access Only'),
                    h('input', { 
                        type: 'password', 
                        placeholder: 'Access Key...', 
                        value: key, 
                        onChange: e => setKey(e.target.value),
                        onKeyDown: e => e.key === 'Enter' && onLogin(key),
                        className: 'w-full bg-black/40 border border-white/5 rounded-2xl px-6 py-5 text-center text-white outline-none focus:border-primary-500 transition-all mb-6'
                    }),
                    h('button', { 
                        onClick: () => onLogin(key),
                        className: 'w-full py-5 bg-primary-600 rounded-2xl text-[10px] font-black uppercase tracking-widest text-white hover:bg-primary-500 transition-all'
                    }, 'Authenticate')
                )
            );
        };

        const Header = ({ selectedDate, setSelectedDate, syncing, setView, onLogout }) => {
            const dateInputRef = useRef(null);

            const navigateDate = (days) => {
                const current = new Date(selectedDate);
                current.setDate(current.getDate() + days);
                setSelectedDate(current.toISOString().split('T')[0]);
            };

            const triggerPicker = () => {
                if (dateInputRef.current) {
                    try {
                        if (typeof dateInputRef.current.showPicker === 'function') {
                            dateInputRef.current.showPicker();
                        } else {
                            dateInputRef.current.click();
                        }
                    } catch (e) {
                        dateInputRef.current.click();
                    }
                }
            };

            const isToday = selectedDate === getToday();

            return h('header', { className: 'pt-8 mb-12 flex flex-col md:flex-row items-center justify-between gap-6' },
                h('div', { className: 'flex items-center gap-4 cursor-pointer', onClick: () => setView('dashboard') },
                    h('div', { className: 'p-4 bg-primary-600 rounded-2xl shadow-xl' }, h(Icon, { name: 'hotel', className: 'text-white', size: 24 })),
                    h('div', null,
                        h('h1', { className: 'text-2xl font-black text-white uppercase tracking-tighter' }, 'Hotel', h('span', { className: 'text-primary-500' }, 'Pro')),
                        h('p', { className: 'text-[9px] font-black text-gray-500 uppercase tracking-[0.4em]' }, 'Obsidian Edition')
                    )
                ),
                h('div', { className: 'flex items-center gap-4' },
                    h('div', { className: 'glass-card px-5 py-2.5 rounded-full flex items-center gap-3 border-white/5 hidden sm:flex' },
                        h(Icon, { name: syncing ? 'refresh-cw' : 'cloud-check', className: syncing ? 'animate-spin text-primary-500' : 'text-emerald-500', size: 14 }),
                        h('span', { className: 'text-[9px] font-black uppercase tracking-widest text-gray-400' }, syncing ? 'Syncing...' : 'Encrypted')
                    ),
                    h('div', { className: 'flex items-center bg-white/5 p-1 rounded-2xl border border-white/10' },
                        h('button', { onClick: () => navigateDate(-1), className: 'p-2 text-gray-400 hover:text-white transition-all rounded-xl hover:bg-white/5' }, h(Icon, { name: 'chevron-left', size: 18 })),
                        h('div', { className: 'relative' },
                            h('button', { 
                                onClick: triggerPicker,
                                className: 'px-4 py-2 text-xs font-black text-white hover:bg-white/5 rounded-xl transition-all flex items-center gap-2'
                            }, 
                                h(Icon, { name: 'calendar', size: 14, className: 'text-primary-500' }),
                                formatDateLong(selectedDate)
                            ),
                            h('input', { 
                                ref: dateInputRef,
                                type: 'date', 
                                value: selectedDate, 
                                onChange: e => setSelectedDate(e.target.value),
                                className: 'absolute inset-0 opacity-0 pointer-events-none'
                            })
                        ),
                        h('button', { onClick: () => navigateDate(1), className: 'p-2 text-gray-400 hover:text-white transition-all rounded-xl hover:bg-white/5' }, h(Icon, { name: 'chevron-right', size: 18 }))
                    ),
                    !isToday && h('button', { onClick: () => setSelectedDate(getToday()), className: 'p-3 bg-primary-600/10 text-primary-500 rounded-xl hover:bg-primary-600 hover:text-white transition-all' }, h(Icon, { name: 'rotate-ccw', size: 18 })),
                    h('button', { onClick: onLogout, className: 'p-3 bg-white/5 rounded-xl hover:bg-rose-500/10 text-gray-500 hover:text-rose-500 transition-all' }, h(Icon, { name: 'log-out', size: 18 }))
                )
            );
        };

        const DashboardView = ({ metrics, data, selectedDate, setSelectedDate }) => {
            const chartData = useMemo(() => {
                return Array.from({ length: 7 }).map((_, i) => {
                    const d = new Date(selectedDate);
                    d.setDate(d.getDate() - (6 - i));
                    const ds = d.toISOString().split('T')[0];
                    const inc = data.income.filter(x => x.date === ds).reduce((s, c) => s + c.amount, 0);
                    const exp = (data.expenses.filter(x => x.date === ds).reduce((s, c) => s + c.amount, 0)) + 
                                (data.advances.filter(x => x.date === ds).reduce((s, c) => s + c.amount, 0));
                    return { name: d.toLocaleDateString('en-US', { weekday: 'short' }), income: inc, expenses: exp };
                });
            }, [data, selectedDate]);

            return h('div', { className: 'space-y-12' },
                h('div', { className: 'grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6' },
                    h(StatCard, { title: 'Daily Credits', value: formatCurrency(metrics.income), icon: 'trending-up', color: '#10b981' }),
                    h(StatCard, { title: 'Daily Debits', value: formatCurrency(metrics.expenses), icon: 'trending-down', color: '#f43f5e' }),
                    h(StatCard, { title: 'Net Yield', value: formatCurrency(metrics.profit), icon: 'wallet', color: '#3b82f6' }),
                    h(StatCard, { title: 'Team Duty', value: `${metrics.staffPresent}/${data.staff.length}`, icon: 'users', color: '#8b5cf6' })
                ),
                h('div', { className: 'grid grid-cols-1 lg:grid-cols-3 gap-8' },
                    h('div', { className: 'lg:col-span-2 glass-card rounded-[4rem] p-10' },
                        h('div', { className: 'flex justify-between items-center mb-10' },
                            h('div', null,
                                h('h3', { className: 'text-xl font-black text-white uppercase tracking-tight' }, 'Fiscal Pulse'),
                                h('p', { className: 'text-[9px] font-black text-gray-500 uppercase tracking-widest' }, '7-Day Flow Analysis')
                            )
                        ),
                        h('div', { className: 'h-[300px]' },
                            h(Chart.ResponsiveContainer, { width: '100%', height: '100%' },
                                h(Chart.AreaChart, { data: chartData },
                                    h(Chart.XAxis, { dataKey: 'name', axisLine: false, tickLine: false, tick: { fill: '#4b5563', fontSize: 10, fontWeight: 800 } }),
                                    h(Chart.Tooltip, { contentStyle: { background: '#111827', border: 'none', borderRadius: '16px' } }),
                                    h(Chart.Area, { type: 'monotone', dataKey: 'income', stroke: '#10b981', fill: '#10b98133', strokeWidth: 3 }),
                                    h(Chart.Area, { type: 'monotone', dataKey: 'expenses', stroke: '#f43f5e', fill: 'transparent', strokeWidth: 3, strokeDasharray: "5 5" })
                                )
                            )
                        )
                    ),
                    h('div', { className: 'glass-card rounded-[4rem] p-10 flex flex-col justify-between' },
                        h('div', null,
                            h('div', { className: 'p-4 bg-primary-600/10 text-primary-500 rounded-2xl w-fit mb-6' }, h(Icon, { name: 'zap', size: 24 })),
                            h('h3', { className: 'text-xl font-black text-white uppercase mb-4' }, 'System Audit'),
                            h('p', { className: 'text-xs font-bold text-gray-500 leading-relaxed' }, 'Registers are balanced. Cloud backup verified.')
                        ),
                        h('button', { className: 'mt-8 py-5 bg-white/5 border border-white/5 rounded-2xl text-[9px] font-black uppercase tracking-[0.3em] text-gray-400 hover:text-white transition-all' }, 'Full History Log')
                    )
                )
            );
        };

        const StatCard = ({ title, value, icon, color }) => h('div', { className: 'glass-card rounded-[2.5rem] p-8 group transition-all' },
            h('div', { className: 'flex justify-between items-start mb-6' },
                h('div', { className: 'p-3 rounded-xl', style: { backgroundColor: `${color}15`, color: color } }, h(Icon, { name: icon, size: 24 })),
                h('div', { className: 'h-1.5 w-1.5 rounded-full animate-pulse', style: { backgroundColor: color } })
            ),
            h('p', { className: 'text-[9px] font-black text-gray-500 uppercase tracking-widest mb-1' }, title),
            h('h4', { className: 'text-2xl font-black text-white tracking-tighter' }, value)
        );

        const LedgerView = ({ type, data, setData, selectedDate, triggerSync }) => {
            const [showModal, setShowModal] = useState(false);
            const [confirmDeleteTarget, setConfirmDeleteTarget] = useState(null);
            const [form, setForm] = useState({ amount: '', note: '', category: 'General' });
            
            const filtered = (type === 'income' ? data.income : data.expenses).filter(x => x.date === selectedDate);
            
            const save = () => {
                const newItem = { id: Date.now(), date: selectedDate, amount: parseFloat(form.amount), note: form.note, category: form.category };
                setData(prev => ({ ...prev, [type]: [...prev[type], newItem] }));
                setShowModal(false);
                setForm({ amount: '', note: '', category: 'General' });
                triggerSync();
            };

            const handleDelete = () => {
                if (!confirmDeleteTarget) return;
                setData(prev => ({ 
                    ...prev, 
                    [type]: prev[type].filter(x => x.id !== confirmDeleteTarget.id) 
                }));
                setConfirmDeleteTarget(null);
                triggerSync();
            };

            const categories = type === 'income' ? ['Room Rent', 'Restaurant', 'Laundry', 'Misc'] : ['Grocery', 'Utility', 'Salary', 'Maintenance'];
            
            return h('div', { className: 'space-y-8' },
                h('div', { className: 'flex justify-between items-center' },
                    h('div', null,
                        h('h2', { className: 'text-3xl font-black text-white uppercase tracking-tighter' }, type),
                        h('p', { className: 'text-[10px] font-black text-gray-500 uppercase tracking-widest' }, `${filtered.length} Entries Today`)
                    ),
                    h('button', { onClick: () => setShowModal(true), className: 'px-8 py-4 bg-primary-600 text-white rounded-2xl text-[10px] font-black uppercase tracking-widest transition-all hover:bg-primary-500' }, 'Add Entry')
                ),
                h('div', { className: 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6' },
                    filtered.map(item => h('div', { key: item.id, className: 'glass-card p-8 rounded-[2.5rem] relative group' },
                        h('div', { className: 'flex justify-between items-start mb-4' },
                            h('div', null,
                                h('p', { className: 'text-[10px] font-black text-primary-500 uppercase tracking-widest mb-1' }, item.category),
                                h('h4', { className: 'text-xl font-black text-white' }, formatCurrency(item.amount))
                            ),
                            h('button', { 
                                onClick: () => setConfirmDeleteTarget(item), 
                                className: 'p-3 bg-white/5 text-gray-500 rounded-xl hover:bg-rose-500/10 hover:text-rose-500 transition-all' 
                            }, h(Icon, { name: 'trash-2', size: 16 }))
                        ),
                        h('p', { className: 'text-xs font-bold text-gray-500 italic' }, item.note || 'No audit notes.')
                    ))
                ),
                showModal && h(Modal, { title: `Add ${type}`, onClose: () => setShowModal(false) },
                    h('div', { className: 'space-y-6' },
                        h('select', { value: form.category, onChange: e => setForm({...form, category: e.target.value}), className: 'w-full bg-black border border-white/10 rounded-xl p-4 text-white font-bold' }, categories.map(c => h('option', { key: c, value: c }, c))),
                        h('input', { type: 'number', placeholder: 'Amount', value: form.amount, onChange: e => setForm({...form, amount: e.target.value}), className: 'w-full bg-black border border-white/10 rounded-xl p-4 text-white font-bold' }),
                        h('textarea', { placeholder: 'Notes', value: form.note, onChange: e => setForm({...form, note: e.target.value}), className: 'w-full bg-black border border-white/10 rounded-xl p-4 text-white h-24 font-bold' }),
                        h('button', { onClick: save, className: 'w-full py-5 bg-primary-600 rounded-xl text-white font-black text-[10px] uppercase tracking-widest' }, 'Confirm Entry')
                    )
                ),
                confirmDeleteTarget && h(ConfirmModal, {
                    title: `Wipe ${type} Entry?`,
                    message: "This audit record will be permanently deleted from the cloud database. This action cannot be reversed.",
                    onConfirm: handleDelete,
                    onCancel: () => setConfirmDeleteTarget(null)
                })
            );
        };

        const StaffView = ({ data, setData, selectedDate, triggerSync }) => {
            const [mode, setMode] = useState('attendance');
            const [payrollModal, setPayrollModal] = useState({ open: false, staff_id: null });
            const [confirmDeleteStaff, setConfirmDeleteStaff] = useState(null);
            const [advanceForm, setAdvanceForm] = useState({ amount: '', date: selectedDate });
            
            const dayAtt = data.attendance.filter(a => a.date === selectedDate);
            const currentMonth = new Date(selectedDate).getMonth();
            const currentYear = new Date(selectedDate).getFullYear();

            const toggleAttendance = (sid, status) => {
                const filtered = data.attendance.filter(a => !(a.staff_id === sid && a.date === selectedDate));
                setData(prev => ({ ...prev, attendance: [...filtered, { staff_id: sid, date: selectedDate, status }] }));
                triggerSync();
            };

            const submitAdvance = () => {
                const newAdvance = { id: Date.now(), staff_id: payrollModal.staff_id, amount: parseFloat(advanceForm.amount), date: advanceForm.date };
                setData(prev => ({ ...prev, advances: [...(prev.advances || []), newAdvance] }));
                setPayrollModal({ open: false, staff_id: null });
                setAdvanceForm({ amount: '', date: selectedDate });
                triggerSync();
            };

            const handleDeleteStaff = () => {
                if (!confirmDeleteStaff) return;
                setData(prev => ({
                    ...prev,
                    staff: prev.staff.filter(s => s.id !== confirmDeleteStaff.id),
                    attendance: prev.attendance.filter(a => a.staff_id !== confirmDeleteStaff.id),
                    advances: prev.advances.filter(a => a.staff_id !== confirmDeleteStaff.id)
                }));
                setConfirmDeleteStaff(null);
                triggerSync();
            };

            const getMonthlyAdvance = (sid) => {
                return (data.advances || [])
                    .filter(a => a.staff_id === sid)
                    .filter(a => {
                        const d = new Date(a.date);
                        return d.getMonth() === currentMonth && d.getFullYear() === currentYear;
                    })
                    .reduce((s, c) => s + c.amount, 0);
            };

            return h('div', { className: 'space-y-10' },
                h('div', { className: 'flex bg-black/40 p-2 rounded-full w-fit mx-auto' },
                    h('button', { onClick: () => setMode('attendance'), className: `px-10 py-3 rounded-full text-[9px] font-black uppercase tracking-widest ${mode === 'attendance' ? 'bg-primary-600 text-white shadow-xl' : 'text-gray-500'}` }, 'Attendance'),
                    h('button', { onClick: () => setMode('list'), className: `px-10 py-3 rounded-full text-[9px] font-black uppercase tracking-widest ${mode === 'list' ? 'bg-primary-600 text-white shadow-xl' : 'text-gray-500'}` }, 'Directory')
                ),
                mode === 'attendance' ? h('div', { className: 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6' },
                    data.staff.map(s => {
                        const status = dayAtt.find(a => a.staff_id === s.id)?.status;
                        return h('div', { key: s.id, className: `p-8 rounded-[3rem] border transition-all duration-500 ${status === 'Present' ? 'border-emerald-500/20 bg-emerald-500/5' : 'glass-card'}` },
                            h('h4', { className: 'text-lg font-black text-white uppercase mb-2' }, s.name),
                            h('p', { className: 'text-[9px] font-black text-gray-500 uppercase mb-8' }, s.role),
                            h('div', { className: 'flex gap-3' },
                                h('button', { onClick: () => toggleAttendance(s.id, 'Present'), className: `flex-1 py-4 rounded-2xl text-[8px] font-black uppercase ${status === 'Present' ? 'bg-emerald-600 shadow-lg shadow-emerald-600/20' : 'bg-white/5 text-gray-500 hover:text-white transition-all'}` }, 'Present'),
                                h('button', { onClick: () => toggleAttendance(s.id, 'Absent'), className: `flex-1 py-4 rounded-2xl text-[8px] font-black uppercase ${status === 'Absent' ? 'bg-rose-600 shadow-lg shadow-rose-600/20' : 'bg-white/5 text-gray-500 hover:text-white transition-all'}` }, 'Absent')
                            )
                        );
                    })
                ) : h('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-8' },
                    data.staff.map(s => {
                        const monthlyAdv = getMonthlyAdvance(s.id);
                        const netPayable = s.salary - monthlyAdv;
                        const progress = Math.min(100, (monthlyAdv / s.salary) * 100);

                        return h('div', { key: s.id, className: 'glass-card p-10 rounded-[3.5rem] flex flex-col justify-between relative group' },
                            h('div', { className: 'flex justify-between items-start mb-8' },
                                h('div', null,
                                    h('h4', { className: 'text-2xl font-black text-white' }, s.name),
                                    h('p', { className: 'text-[10px] font-black text-gray-500 uppercase tracking-widest mt-1' }, s.role)
                                ),
                                h('div', { className: 'flex gap-3' },
                                    h('button', { 
                                        onClick: () => setPayrollModal({ open: true, staff_id: s.id }),
                                        className: 'p-4 bg-primary-600/10 text-primary-500 rounded-2xl hover:bg-primary-600 hover:text-white transition-all shadow-inner'
                                    }, h(Icon, { name: 'banknote', size: 20 })),
                                    h('button', { 
                                        onClick: () => setConfirmDeleteStaff(s),
                                        className: 'p-4 bg-rose-500/10 text-rose-500 rounded-2xl hover:bg-rose-600 hover:text-white transition-all shadow-inner'
                                    }, h(Icon, { name: 'user-minus', size: 20 }))
                                )
                            ),
                            h('div', { className: 'space-y-6' },
                                h('div', { className: 'grid grid-cols-2 gap-4' },
                                    h('div', null,
                                        h('p', { className: 'text-[9px] font-black text-gray-500 uppercase mb-1' }, 'Base Salary'),
                                        h('p', { className: 'text-lg font-black text-white' }, formatCurrency(s.salary))
                                    ),
                                    h('div', { className: 'text-right' },
                                        h('p', { className: 'text-[9px] font-black text-rose-500 uppercase mb-1' }, 'Adv. Month'),
                                        h('p', { className: 'text-lg font-black text-rose-500' }, formatCurrency(monthlyAdv))
                                    )
                                ),
                                h('div', { className: 'h-1.5 w-full bg-white/5 rounded-full overflow-hidden' },
                                    h('div', { className: 'h-full bg-primary-500 transition-all duration-1000', style: { width: `${progress}%` } })
                                ),
                                h('div', { className: 'flex justify-between items-center pt-4 border-t border-white/5' },
                                    h('p', { className: 'text-[10px] font-black text-gray-500 uppercase tracking-widest' }, 'Net Balance'),
                                    h('p', { className: `text-2xl font-black ${netPayable > 0 ? 'text-primary-500' : 'text-rose-500'}` }, formatCurrency(netPayable))
                                )
                            )
                        );
                    })
                ),
                payrollModal.open && h(Modal, { title: 'Log Salary Advance', onClose: () => setPayrollModal({ open: false, staff_id: null }) },
                    h('div', { className: 'space-y-8' },
                        h('div', null,
                            h('label', { className: 'text-[10px] font-black text-gray-500 uppercase mb-3 block' }, 'Advance Value (INR)'),
                            h('input', { 
                                type: 'number', 
                                value: advanceForm.amount, 
                                onChange: e => setAdvanceForm({...advanceForm, amount: e.target.value}),
                                className: 'w-full bg-black border border-white/10 rounded-2xl p-6 text-white text-xl font-black outline-none focus:border-primary-500 transition-all'
                            })
                        ),
                        h('div', null,
                            h('label', { className: 'text-[10px] font-black text-gray-500 uppercase mb-3 block' }, 'Payment Date'),
                            h('input', { 
                                type: 'date', 
                                value: advanceForm.date, 
                                onChange: e => setAdvanceForm({...advanceForm, date: e.target.value}),
                                className: 'w-full bg-black border border-white/10 rounded-2xl p-6 text-white font-bold'
                            })
                        ),
                        h('button', { 
                            onClick: submitAdvance, 
                            className: 'w-full py-6 bg-primary-600 rounded-2xl text-white font-black text-[11px] uppercase tracking-widest shadow-2xl shadow-primary-600/30 active:scale-95 transition-all' 
                        }, 'Confirm Advance')
                    )
                ),
                confirmDeleteStaff && h(ConfirmModal, {
                    title: 'Terminate Personnel?',
                    message: `Are you sure you want to remove ${confirmDeleteStaff.name} from the directory? All attendance and payroll logs will be purged.`,
                    onConfirm: handleDeleteStaff,
                    onCancel: () => setConfirmDeleteStaff(null)
                })
            );
        };

        const ReportsView = ({ data }) => {
            // Updated: Default start year set to 2026
            const [selectedYear, setSelectedYear] = useState(2026);
            const [selectedMonthIndex, setSelectedMonthIndex] = useState(new Date().getMonth());

            const monthlyData = useMemo(() => {
                return Array.from({ length: 12 }).map((_, i) => {
                    const month = i;
                    const incomeEntries = data.income.filter(item => {
                        const d = new Date(item.date);
                        return d.getFullYear() === selectedYear && d.getMonth() === month;
                    });
                    const income = incomeEntries.reduce((sum, item) => sum + item.amount, 0);

                    const expensesList = data.expenses.filter(item => {
                        const d = new Date(item.date);
                        return d.getFullYear() === selectedYear && d.getMonth() === month;
                    });
                    
                    const advancesList = (data.advances || []).filter(item => {
                        const d = new Date(item.date);
                        return d.getFullYear() === selectedYear && d.getMonth() === month;
                    });

                    // Total Operational Expenses = Regular ledger expenses + logged advances
                    const totalExp = expensesList.reduce((sum, item) => sum + item.amount, 0) + 
                                     advancesList.reduce((sum, item) => sum + item.amount, 0);
                                     
                    // Total Salaries = Regular expenses categorized as 'Salary' + all advances
                    const salaries = expensesList.filter(e => e.category === 'Salary').reduce((sum, item) => sum + item.amount, 0) +
                                     advancesList.reduce((sum, item) => sum + item.amount, 0);
                    
                    // Detailed category breakdown for visual cards
                    const categoryBreakdown = expensesList.reduce((acc, curr) => {
                        acc[curr.category] = (acc[curr.category] || 0) + curr.amount;
                        return acc;
                    }, {});
                    categoryBreakdown['Salary'] = (categoryBreakdown['Salary'] || 0) + advancesList.reduce((s, c) => s + c.amount, 0);

                    const incomeBreakdown = incomeEntries.reduce((acc, curr) => {
                        acc[curr.category] = (acc[curr.category] || 0) + curr.amount;
                        return acc;
                    }, {});

                    return { 
                        month: getMonthName(month), 
                        income, 
                        expenses: totalExp, 
                        salaries, 
                        profit: income - totalExp,
                        categoryBreakdown,
                        incomeBreakdown
                    };
                });
            }, [data, selectedYear]);

            const currentSummary = monthlyData[selectedMonthIndex];

            const handleExport = (type) => {
                if (type === 'pdf') {
                    const doc = new window.jspdf.jsPDF();
                    doc.setFontSize(18);
                    doc.text(`HotelPro Financial Audit - ${selectedYear}`, 14, 20);
                    const head = [['Month', 'Income', 'Total Expenses (incl. Adv)', 'Salaries Paid', 'Net Yield']];
                    const body = monthlyData.map(m => [
                        m.month, 
                        formatCurrency(m.income), 
                        formatCurrency(m.expenses), 
                        formatCurrency(m.salaries), 
                        formatCurrency(m.profit)
                    ]);
                    doc.autoTable({ head, body, startY: 30, theme: 'grid' });
                    doc.save(`HotelPro_Audit_${selectedYear}.pdf`);
                } else {
                    const ws = XLSX.utils.json_to_sheet(monthlyData.map(m => ({
                        Month: m.month,
                        Income: m.income,
                        Expenses: m.expenses,
                        Salaries: m.salaries,
                        Profit: m.profit
                    })));
                    const wb = XLSX.utils.book_new();
                    XLSX.utils.book_append_sheet(wb, ws, 'Financials');
                    XLSX.writeFile(wb, `HotelPro_Audit_${selectedYear}.xlsx`);
                }
            };

            return h('div', { className: 'space-y-12 pb-32' },
                // Financial Header
                h('div', { className: 'glass-card p-10 rounded-[4rem] flex flex-col md:flex-row justify-between items-center gap-8 relative overflow-hidden' },
                    h('div', { className: 'absolute inset-0 bg-primary-600/5 blur-[100px] pointer-events-none' }),
                    h('div', { className: 'relative z-10' },
                        h('h3', { className: 'text-3xl font-black text-white uppercase tracking-tighter' }, 'Audit Center'),
                        h('p', { className: 'text-[10px] font-black text-gray-500 uppercase tracking-[0.4em] mt-2' }, `Annual fiscal reporting for ${selectedYear}`)
                    ),
                    h('div', { className: 'flex flex-wrap items-center justify-center gap-4 relative z-10' },
                        h('select', { 
                            value: selectedYear, 
                            onChange: e => setSelectedYear(Number(e.target.value)), 
                            className: 'bg-black/40 border border-white/10 rounded-xl px-6 py-4 text-xs font-black text-white outline-none focus:border-primary-500 transition-all' 
                        }, [2026, 2027, 2028, 2029, 2030].map(y => h('option', { key: y, value: y, className: 'bg-black' }, y))),
                        h('button', { onClick: () => handleExport('pdf'), className: 'px-8 py-4 bg-rose-600 text-white rounded-2xl text-[9px] font-black uppercase tracking-widest shadow-xl shadow-rose-600/20 active:scale-95' }, 'Export PDF'),
                        h('button', { onClick: () => handleExport('xlsx'), className: 'px-8 py-4 bg-emerald-600 text-white rounded-2xl text-[9px] font-black uppercase tracking-widest shadow-xl shadow-emerald-600/20 active:scale-95' }, 'Export Excel')
                    )
                ),

                // Selected Month Deep Dive Cards
                h('div', { className: 'grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6' },
                    h('div', { className: 'glass-card p-8 rounded-[3rem] border-emerald-500/20 bg-emerald-500/[0.02]' },
                        h('p', { className: 'text-[10px] font-black text-emerald-500 uppercase tracking-widest mb-2' }, `${currentSummary.month} Income`),
                        h('h4', { className: 'text-2xl font-black text-white' }, formatCurrency(currentSummary.income))
                    ),
                    h('div', { className: 'glass-card p-8 rounded-[3rem] border-rose-500/20 bg-rose-500/[0.02]' },
                        h('p', { className: 'text-[10px] font-black text-rose-500 uppercase tracking-widest mb-2' }, `${currentSummary.month} Expenses`),
                        h('h4', { className: 'text-2xl font-black text-white' }, formatCurrency(currentSummary.expenses))
                    ),
                    h('div', { className: 'glass-card p-8 rounded-[3rem] border-primary-500/20 bg-primary-500/[0.02]' },
                        h('p', { className: 'text-[10px] font-black text-primary-500 uppercase tracking-widest mb-2' }, `Total Salaries Paid`),
                        h('h4', { className: 'text-2xl font-black text-white' }, formatCurrency(currentSummary.salaries))
                    ),
                    h('div', { className: 'glass-card p-8 rounded-[3rem] border-purple-500/20 bg-purple-500/[0.02]' },
                        h('p', { className: 'text-[10px] font-black text-purple-500 uppercase tracking-widest mb-2' }, `Month Net Yield`),
                        h('h4', { className: `text-2xl font-black ${currentSummary.profit >= 0 ? 'text-emerald-500' : 'text-rose-500'}` }, formatCurrency(currentSummary.profit))
                    )
                ),

                // Detailed Table
                h('div', { className: 'glass-card rounded-[4rem] overflow-hidden' },
                    h('div', { className: 'p-10 border-b border-white/5 flex flex-col sm:flex-row justify-between items-center gap-6' },
                        h('div', null,
                            h('h4', { className: 'text-xl font-black text-white uppercase' }, 'Detailed Monthly Ledger'),
                            h('p', { className: 'text-[9px] font-black text-gray-500 uppercase tracking-widest mt-1' }, 'Excludes internal balancing / tax adjustments')
                        ),
                        h('div', { className: 'flex p-1.5 bg-black/40 rounded-2xl border border-white/10' },
                            h('select', {
                                value: selectedMonthIndex,
                                onChange: e => setSelectedMonthIndex(Number(e.target.value)),
                                className: 'bg-transparent text-[10px] font-black text-primary-500 uppercase tracking-widest outline-none px-4 py-2 cursor-pointer'
                            }, Array.from({ length: 12 }).map((_, i) => h('option', { key: i, value: i, className: 'bg-black' }, getMonthName(i))))
                        )
                    ),
                    h('div', { className: 'overflow-x-auto custom-scrollbar' },
                        h('table', { className: 'w-full text-left' },
                            h('thead', { className: 'bg-white/5' },
                                h('tr', null,
                                    ['Period', 'Gross Income', 'Gross Expenses', 'Salaries (Log+Adv)', 'Operational Surplus'].map(hText => h('th', { key: hText, className: 'px-10 py-8 text-[10px] font-black text-gray-500 uppercase tracking-widest' }, hText))
                                )
                            ),
                            h('tbody', { className: 'divide-y divide-white/5' },
                                monthlyData.map((m, idx) => h('tr', { 
                                    key: idx, 
                                    onClick: () => setSelectedMonthIndex(idx),
                                    className: `hover:bg-white/5 transition-colors cursor-pointer group ${selectedMonthIndex === idx ? 'bg-primary-600/5' : ''}` 
                                },
                                    h('td', { className: 'px-10 py-8 text-sm font-black text-white flex items-center gap-3' }, 
                                        m.month,
                                        selectedMonthIndex === idx && h(Icon, { name: 'arrow-right-circle', size: 14, className: 'text-primary-500' })
                                    ),
                                    h('td', { className: 'px-10 py-8 text-sm font-bold text-emerald-500' }, formatCurrency(m.income)),
                                    h('td', { className: 'px-10 py-8 text-sm font-bold text-rose-500' }, formatCurrency(m.expenses)),
                                    h('td', { className: 'px-10 py-8 text-sm font-black text-white' }, formatCurrency(m.salaries)),
                                    h('td', { className: `px-10 py-8 text-lg font-black ${m.profit >= 0 ? 'text-primary-500' : 'text-rose-600'}` }, formatCurrency(m.profit))
                                ))
                            )
                        )
                    )
                ),

                // Category Breakdown Visuals for Selected Month
                h('div', { className: 'grid grid-cols-1 lg:grid-cols-2 gap-8' },
                    h('div', { className: 'glass-card p-10 rounded-[4rem]' },
                        h('h4', { className: 'text-lg font-black text-white uppercase mb-8' }, `Expense Distribution - ${currentSummary.month}`),
                        h('div', { className: 'space-y-4' },
                            Object.entries(currentSummary.categoryBreakdown).length > 0 ? 
                                Object.entries(currentSummary.categoryBreakdown).map(([cat, amt]) => h('div', { key: cat, className: 'flex justify-between items-center p-4 bg-white/5 rounded-2xl' },
                                    h('span', { className: 'text-[10px] font-black text-gray-400 uppercase tracking-widest' }, cat),
                                    h('span', { className: 'text-xs font-black text-white' }, formatCurrency(amt))
                                )) :
                                h('p', { className: 'text-[10px] font-black text-gray-600 text-center py-10 uppercase' }, 'No Debits recorded for this period')
                        )
                    ),
                    h('div', { className: 'glass-card p-10 rounded-[4rem] flex flex-col justify-center items-center text-center' },
                        h('div', { className: 'p-6 bg-primary-600/10 text-primary-500 rounded-full mb-6' }, h(Icon, { name: 'pie-chart', size: 40 })),
                        h('h4', { className: 'text-xl font-black text-white uppercase mb-4' }, 'Audit Status: Verified'),
                        h('p', { className: 'text-xs font-bold text-gray-500 max-w-xs leading-relaxed' }, 
                            `All ledger entries for ${currentSummary.month} ${selectedYear} have been accurately reconciled. Salaries include both standard ledger entries and direct staff advances.`
                        )
                    )
                )
            );
        };

        const Modal = ({ title, children, onClose }) => h('div', { className: 'fixed inset-0 z-[200] flex items-center justify-center p-6 bg-black/80 backdrop-blur-md' },
            h('div', { className: 'glass-card w-full max-w-lg rounded-[3rem] p-10 relative animate-in zoom-in-95' },
                h('div', { className: 'flex justify-between items-center mb-8' }, h('h3', { className: 'text-xl font-black text-white uppercase' }, title), h('button', { onClick: onClose, className: 'p-2 text-gray-500 hover:text-white transition-all' }, h(Icon, { name: 'x', size: 24 }))),
                children
            )
        );

        const ConfirmModal = ({ title, message, onConfirm, onCancel }) => h('div', { className: 'fixed inset-0 z-[300] flex items-center justify-center p-6 bg-black/90 backdrop-blur-xl' },
            h('div', { className: 'glass-card w-full max-w-sm rounded-[3rem] p-10 text-center animate-in zoom-in-95' },
                h('div', { className: 'p-5 bg-rose-600/10 text-rose-500 rounded-full w-fit mx-auto mb-6' }, h(Icon, { name: 'alert-triangle', size: 32 })),
                h('h3', { className: 'text-xl font-black text-white uppercase mb-4 tracking-tight' }, title),
                h('p', { className: 'text-xs font-bold text-gray-500 leading-relaxed mb-10' }, message),
                h('div', { className: 'flex gap-3' },
                    h('button', { onClick: onCancel, className: 'flex-1 py-4 bg-white/5 rounded-2xl text-[9px] font-black uppercase text-gray-400 hover:text-white transition-all' }, 'Cancel'),
                    h('button', { onClick: onConfirm, className: 'flex-1 py-4 bg-rose-600 rounded-2xl text-[9px] font-black uppercase text-white shadow-xl shadow-rose-600/20 active:scale-95 transition-all' }, 'Delete')
                )
            )
        );

        const QuickNav = ({ current, setView }) => h('div', { className: 'fixed bottom-10 left-1/2 -translate-x-1/2 z-[100] px-6' },
            h('nav', { className: 'flex items-center gap-1.5 p-2.5 glass-nav rounded-full shadow-2xl' },
                [
                    { id: 'dashboard', icon: 'layout-grid' },
                    { id: 'income', icon: 'arrow-up-circle' },
                    { id: 'expenses', icon: 'arrow-down-circle' },
                    { id: 'staff', icon: 'users' },
                    { id: 'reports', icon: 'file-text' }
                ].map(item => h('button', {
                    key: item.id,
                    onClick: () => setView(item.id),
                    className: `p-5 rounded-full transition-all duration-500 ${current === item.id ? 'bg-primary-600 text-white scale-110 shadow-lg' : 'text-gray-500 hover:text-white'}`
                }, h(Icon, { name: item.icon, size: 22 })))
            )
        );

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(h(App));
    </script>
</body>
</html>